/*
* cmd_eye.c- Sigmastar
*
* Copyright (c) [2019~2020] SigmaStar Technology.
*
*
* This software is licensed under the terms of the GNU General Public
* License version 2, as published by the Free Software Foundation, and
* may be copied, distributed, and modified under those terms.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License version 2 for more details.
*
*/


#include <common.h>
#include <command.h>
#include "asm/arch/mach/ms_types.h"
#include "asm/arch/mach/platform.h"
#include "asm/arch/mach/io.h"

#define GET_REG8_ADDRE( y)  	      (MS_BASE_REG_RIU_PA+(y)*2-((y)&1))


void USB20_verification_pattern_TSTPG_FS(void)
{
    printf("%s\n",__FUNCTION__);
    OUTREG8(GET_REG8_ADDRE(0x00142200), 0xff);
    OUTREG8(GET_REG8_ADDRE(0x00142202), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142000), 0xb0);
    OUTREG8(GET_REG8_ADDRE(0x00142001), 0x10);
    OUTREG8(GET_REG8_ADDRE(0x00142004), 0x10);
    OUTREG8(GET_REG8_ADDRE(0x00142005), 0x01);
    OUTREG8(GET_REG8_ADDRE(0x00142108), 0x0f);
    OUTREG8(GET_REG8_ADDRE(0x00142109), 0x04);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0x05);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x7f);
    OUTREG8(GET_REG8_ADDRE(0x001012fe), 0xe1);
    OUTREG8(GET_REG8_ADDRE(0x001012ff), 0x08);
    OUTREG8(GET_REG8_ADDRE(0x00142108), 0x0f);
    OUTREG8(GET_REG8_ADDRE(0x00142109), 0x04);
    OUTREG8(GET_REG8_ADDRE(0x00142120), 0xa1);
    OUTREG8(GET_REG8_ADDRE(0x00142121), 0x80);
    OUTREG8(GET_REG8_ADDRE(0x00142122), 0x88);
    OUTREG8(GET_REG8_ADDRE(0x00142123), 0x20);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0xc3);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x69);
    OUTREG8(GET_REG8_ADDRE(0x00142102), 0x84);
    OUTREG8(GET_REG8_ADDRE(0x00142103), 0x90);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0x01);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x02);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0x01);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x00);
    mdelay(2);
    OUTREG8(GET_REG8_ADDRE(0x0014213c), 0x01);
    OUTREG8(GET_REG8_ADDRE(0x0014213d), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x0014213c), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x0014213d), 0x00);
    mdelay(5);
    OUTREG8(GET_REG8_ADDRE(0x00142110), 0x78);
    OUTREG8(GET_REG8_ADDRE(0x00142111), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142106), 0x43);
    OUTREG8(GET_REG8_ADDRE(0x00142107), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142106), 0x40);
    OUTREG8(GET_REG8_ADDRE(0x00142107), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0xeb);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142114), 0x40);
    OUTREG8(GET_REG8_ADDRE(0x00142115), 0x07);
    OUTREG8(GET_REG8_ADDRE(0x00142134), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142135), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142132), 0xfe);
    OUTREG8(GET_REG8_ADDRE(0x00142133), 0x0b);
}
void USB20_verification_pattern_TSTPG(void)
{
    printf("%s\n",__FUNCTION__);
    OUTREG8(GET_REG8_ADDRE(0x00142200), 0xff);
    OUTREG8(GET_REG8_ADDRE(0x00142202), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142000), 0xb0);
    OUTREG8(GET_REG8_ADDRE(0x00142001), 0x10);
    OUTREG8(GET_REG8_ADDRE(0x00142004), 0x10);
    OUTREG8(GET_REG8_ADDRE(0x00142005), 0x01);
    OUTREG8(GET_REG8_ADDRE(0x00142108), 0x0f);
    OUTREG8(GET_REG8_ADDRE(0x00142109), 0x04);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0x05);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x7f);
    OUTREG8(GET_REG8_ADDRE(0x001012fe), 0xe1);
    OUTREG8(GET_REG8_ADDRE(0x001012ff), 0x08);
    OUTREG8(GET_REG8_ADDRE(0x00142108), 0x0f);
    OUTREG8(GET_REG8_ADDRE(0x00142109), 0x04);
    OUTREG8(GET_REG8_ADDRE(0x00142120), 0xa1);
    OUTREG8(GET_REG8_ADDRE(0x00142121), 0x80);
    OUTREG8(GET_REG8_ADDRE(0x00142122), 0x88);
    OUTREG8(GET_REG8_ADDRE(0x00142123), 0x20);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0x03);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x6b);
    mdelay(1);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0xc3);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x69);
    mdelay(2);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0x01);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x0014213c), 0x01);
    OUTREG8(GET_REG8_ADDRE(0x0014213d), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x0014213c), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x0014213d), 0x00);
    mdelay(2);
    OUTREG8(GET_REG8_ADDRE(0x00142110), 0x78);
    OUTREG8(GET_REG8_ADDRE(0x00142111), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142106), 0x43);
    OUTREG8(GET_REG8_ADDRE(0x00142107), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142106), 0x40);
    OUTREG8(GET_REG8_ADDRE(0x00142107), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142100), 0x01);
    OUTREG8(GET_REG8_ADDRE(0x00142101), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142114), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142115), 0x06);
    OUTREG8(GET_REG8_ADDRE(0x00142134), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142135), 0x00);
    OUTREG8(GET_REG8_ADDRE(0x00142132), 0xfe);
    OUTREG8(GET_REG8_ADDRE(0x00142133), 0x0b);
}

int do_eye (cmd_tbl_t *cmdtp, int flag, int argc, char * const argv[])
{
	if(strcmp(argv[1], "hs") == 0)
	{

        USB20_verification_pattern_TSTPG();
		//while(1);
		return 0;
	}
	if(strcmp(argv[1], "fs") == 0)
	{
        USB20_verification_pattern_TSTPG_FS();
		//while(1);
		return 0;
	}
	return CMD_RET_USAGE;
}
U_BOOT_CMD(
	usb_eye, 2,	1, do_eye,
	"test eye",
	"hs  - high speed\n"
	"usb_eye fs  - full speed\n"
);
